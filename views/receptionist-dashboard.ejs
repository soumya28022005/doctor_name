<%- include('partials/header.ejs') %>

<div class="dashboard-header">
    <h1>Welcome, <%= receptionist.name %> (Receptionist)</h1>
    <p>Managing <%= clinic.name %> - <%= clinic.address %></p>
</div>

<div class="dashboard-grid">
    <!-- Doctor Join Requests Card -->
    <% if (joinRequests && joinRequests.length > 0) { %>
    <div class="card" style="background: #fffbeb; border-left: 4px solid #f59e0b;">
        <h3>Doctor Join Requests (<%= joinRequests.length %>)</h3>
        <ul class="appointment-list">
            <% joinRequests.forEach(req => { %>
                <li class="appointment-item">
                    <div style="display: flex; justify-content: space-between; align-items: center; gap: 1rem;">
                        <div style="flex-grow: 1;">
                            <strong>Dr. <%= req.doctorName %></strong> (<%= req.doctorSpecialty %>) wants to join.<br>
                            <small>Proposed Schedule: <%= req.schedule.startTime %> - <%= req.schedule.endTime %> on <%= req.schedule.days %></small>
                        </div>
                        <div style="display: flex; gap: 0.5rem; flex-shrink: 0;">
                            <form action="/receptionist/handle-join-request" method="POST">
                                <input type="hidden" name="requestId" value="<%= req.id %>">
                                <input type="hidden" name="receptionistId" value="<%= receptionist.id %>">
                                <input type="hidden" name="action" value="accept">
                                <button type="submit" class="btn btn-success btn-small">Accept</button>
                            </form>
                            <form action="/receptionist/handle-join-request" method="POST" onsubmit="return confirm('Are you sure you want to delete this request?');">
                                <input type="hidden" name="requestId" value="<%= req.id %>">
                                <input type="hidden" name="receptionistId" value="<%= receptionist.id %>">
                                <input type="hidden" name="action" value="delete">
                                <button type="submit" class="btn btn-danger btn-small">Delete</button>
                            </form>
                        </div>
                    </div>
                </li>
            <% }) %>
        </ul>
    </div>
    <% } %>


    <div class="card">
        <h3>Add New Doctor to <%= clinic.name %></h3>
        <form action="/receptionist/add-doctor" method="POST">
            <input type="hidden" name="receptionistId" value="<%= receptionist.id %>">
            
            <div class="form-group">
                <label for="name">Doctor's Full Name</label>
                <input type="text" id="name" name="name" required>
            </div>
            <div class="form-group">
                <label for="specialty">Specialty</label>
                <input type="text" id="specialty" name="specialty" required>
            </div>
            <div class="form-group">
                <label for="username">Create Username</label>
                <input type="text" id="username" name="username" required>
            </div>
            <div class="form-group">
                <label for="password">Create Password</label>
                <input type="password" id="password" name="password" required>
            </div>
            <div class="form-group">
                <label for="startTime">Start Time</label>
                <input type="time" id="startTime" name="startTime" required>
            </div>
            <div class="form-group">
                <label for="endTime">End Time</label>
                <input type="time" id="endTime" name="endTime" required>
            </div>
            
            <hr>
            <p><strong>Select Weekly Schedule:</strong></p>
            
            <div class="form-group">
                <div style="display: flex; flex-wrap: wrap; gap: 15px; margin-top: 5px;">
                    <label><input type="checkbox" class="day-checkbox" name="days" value="Sunday"> Sunday</label>
                    <label><input type="checkbox" class="day-checkbox" name="days" value="Monday"> Monday</label>
                    <label><input type="checkbox" class="day-checkbox" name="days" value="Tuesday"> Tuesday</label>
                    <label><input type="checkbox" class="day-checkbox" name="days" value="Wednesday"> Wednesday</label>
                    <label><input type="checkbox" class="day-checkbox" name="days" value="Thursday"> Thursday</label>
                    <label><input type="checkbox" class="day-checkbox" name="days" value="Friday"> Friday</label>
                    <label><input type="checkbox" class="day-checkbox" name="days" value="Saturday"> Saturday</label>
                </div>
                <div style="margin-top: 10px;">
                    <label style="font-weight: bold; color: #007bff;">
                        <input type="checkbox" id="select-all-days"> Every Day
                    </label>
                </div>
            </div>

            <p style="text-align: center; font-weight: bold; margin: 1rem 0;">OR</p>

            <div class="form-group">
                <label for="customSchedule"><strong>Enter Custom Schedule Rule:</strong></label>
                <input type="text" id="customSchedule" name="customSchedule" class="form-control" placeholder="e.g., 1st week of month">
            </div>
            <button type="submit" class="btn">Add Doctor</button>
        </form>
    </div>

   

    <div class="card">
        <h3>Doctors Available at <%= clinic.name %> (<%= doctors.length %>)</h3>
        <ul class="appointment-list">
            <% if(doctors.length > 0) { %>
                <% doctors.forEach(doc => { %>
                    <li class="appointment-item">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <!-- Doctor Info -->
                            <div style="flex-grow: 1;">
                              <a href="/receptionist/doctor-appointments/<%= doc.id %>?receptionistId=<%= receptionist.id %>" style="text-decoration: none; color: inherit;">
                                    <strong><%= doc.name %></strong>
                                </a> 
                                (<%= doc.specialty %>)<br>
                                <small>Schedule: <%= doc.schedule.startTime %> - <%= doc.schedule.endTime %></small><br>
                                <small>Days: <%= doc.schedule.days %></small> 
                            </div>
                            <!-- Delete Form -->
                            <form action="/receptionist/delete-doctor" method="POST" onsubmit="return confirm('Are you sure you want to delete this doctor? This action cannot be undone.');">
                                <input type="hidden" name="doctorId" value="<%= doc.id %>">
                                <input type="hidden" name="receptionistId" value="<%= receptionist.id %>">
                                <button type="submit" class="btn btn-danger btn-small">Delete</button>
                            </form>
                        </div>
                    </li>
                <% }) %>
            <% } else { %>
                <p>No doctors assigned to <%= clinic.name %>.</p>
            <% } %>
        </ul>
    </div>

</div>

<script>
    document.getElementById('select-all-days').addEventListener('change', function(event) {
        const isChecked = event.target.checked;
        const dayCheckboxes = document.querySelectorAll('.day-checkbox');
        dayCheckboxes.forEach(checkbox => {
            checkbox.checked = isChecked;
        });
    });
</script>

<%- include('partials/footer.ejs') %>
