<%- include('partials/header.ejs') %>

<h1>Welcome, <%= admin.name %> (Admin)</h1>

<div class="dashboard-grid">

  <!-- Clinics Management -->
  <div class="card">
    <h3>Clinics (<%= clinics.length %>)</h3>
    <ul>
      <% clinics.forEach(c => { %>
        <li>
          ğŸ¥ <strong><%= c.name %></strong>  
          (ID: <%= c.id %>)  
          <br>ğŸ“ <%= c.address %> | ğŸ“ <%= c.phone %>
          <form action="/admin/delete-clinic" method="POST" style="display:inline;">
            <input type="hidden" name="clinicId" value="<%= c.id %>">
            <input type="hidden" name="adminId" value="<%= admin.id %>">
            <button type="submit">ğŸ—‘ Delete</button>
          </form>
        </li>
      <% }) %>
    </ul>

    <h4>Add New Clinic</h4>
    <form action="/admin/add-clinic" method="POST" class="form-block">
      <input type="hidden" name="adminId" value="<%= admin.id %>">
      <input type="text" name="name" placeholder="Clinic Name" required>
      <input type="text" name="address" placeholder="Address" required>
      <input type="text" name="phone" placeholder="Phone" required>
      <button type="submit">â• Add Clinic</button>
    </form>
  </div>

  <!-- Doctors Management -->
  <div class="card">
    <h3>Doctors (<%= doctors.length %>)</h3>
    <ul>
      <% doctors.forEach(d => { %>
        <li>
          ğŸ‘¨â€âš•ï¸ <strong><%= d.name %></strong>  
          (ID: <%= d.id %>, Specialty: <%= d.specialty %>)  
          <br>ğŸ‘¤ Username: <%= d.username %> | ğŸ”‘ Password: <%= d.password %>
          <form action="/admin/delete-doctor" method="POST" style="display:inline;">
            <input type="hidden" name="doctorId" value="<%= d.id %>">
            <input type="hidden" name="adminId" value="<%= admin.id %>">
            <button type="submit">ğŸ—‘ Delete</button>
          </form>
        </li>
      <% }) %>
    </ul>

    <!-- Keep existing Add Doctor Form -->
    <h4>Add New Doctor</h4>
    <form action="/admin/add-doctor" method="POST" class="form-block">
      <input type="hidden" name="adminId" value="<%= admin.id %>">

      <div class="form-group">
        <label>Doctor's Full Name</label>
        <input type="text" name="name" required>
      </div>

      <div class="form-group">
        <label>Specialty</label>
        <input type="text" name="specialty" required>
      </div>

      <div class="form-group">
        <label>Create Username</label>
        <input type="text" name="username" required>
      </div>

      <div class="form-group">
        <label>Create Password</label>
        <input type="password" name="password" required>
      </div>

      <div class="form-group">
        <label>Assign Location:</label>
        <select name="locationType" id="locationType" onchange="toggleLocationFields()" required>
          <option value="">-- Select --</option>
          <option value="clinic">Existing Clinic</option>
          <option value="custom">Private Practice (Custom Address)</option>
        </select>
      </div>

      <!-- Existing Clinic -->
      <div id="clinicSelect" style="display:none;">
        <label>Select Clinic:</label>
        <select name="clinicId">
          <% clinics.forEach(c => { %>
            <option value="<%= c.id %>"><%= c.name %></option>
          <% }) %>
        </select>
      </div>

      <!-- Custom Address -->
      <div id="customAddress" style="display:none;">
        <label>Custom Address:</label>
        <input type="text" name="customAddress" placeholder="Enter Address">
      </div>

      <div class="form-group">
        <label>Start Time</label>
        <input type="time" name="startTime" required>
      </div>

      <div class="form-group">
        <label>End Time</label>
        <input type="time" name="endTime" required>
      </div>

      <hr>
      <p><strong>Select Weekly Schedule:</strong></p>

      <div class="form-group">
        <label><input type="checkbox" class="day-checkbox" name="days" value="Sunday"> Sunday</label>
        <label><input type="checkbox" class="day-checkbox" name="days" value="Monday"> Monday</label>
        <label><input type="checkbox" class="day-checkbox" name="days" value="Tuesday"> Tuesday</label>
        <label><input type="checkbox" class="day-checkbox" name="days" value="Wednesday"> Wednesday</label>
        <label><input type="checkbox" class="day-checkbox" name="days" value="Thursday"> Thursday</label>
        <label><input type="checkbox" class="day-checkbox" name="days" value="Friday"> Friday</label>
        <label><input type="checkbox" class="day-checkbox" name="days" value="Saturday"> Saturday</label>
      </div>
      <div>
        <label style="font-weight: bold; color: #007bff;">
          <input type="checkbox" id="select-all-days"> Every Day
        </label>
      </div>

      <p style="text-align:center;font-weight:bold;margin:1rem 0;">OR</p>

      <div class="form-group">
        <label>Custom Schedule</label>
        <input type="text" name="customSchedule" placeholder="e.g., 1st week of month">
      </div>

      <button type="submit" class="btn">â• Add Doctor</button>
    </form>
  </div>

  <!-- Patients Management -->
  <div class="card">
    <h3>Patients (<%= patients.length %>)</h3>
    <ul>
      <% patients.forEach(p => { %>
        <li>
          ğŸ§‘ <strong><%= p.name %></strong>  
          (ID: <%= p.id %>)  
          <br>ğŸ‘¤ Username: <%= p.username %> | ğŸ”‘ Password: <%= p.password %>  
          ğŸ“… DOB: <%= p.dob %> | ğŸ“ <%= p.mobile %>
        </li>
      <% }) %>
    </ul>

    <h4>Add New Patient</h4>
    <form action="/receptionist/add-patient" method="POST" class="form-block">
      <input type="hidden" name="receptionistId" value="1"> <!-- Or handle properly for admin later -->

      <div class="form-group">
        <label>Patient Name</label>
        <input type="text" name="name" required>
      </div>

      <div class="form-group">
        <label>Date of Birth</label>
        <input type="date" name="dob" required>
      </div>

      <div class="form-group">
        <label>Mobile</label>
        <input type="text" name="mobile" required>
      </div>

      <div class="form-group">
        <label>Username</label>
        <input type="text" name="username" required>
      </div>

      <div class="form-group">
        <label>Password</label>
        <input type="password" name="password" required>
      </div>

      <button type="submit" class="btn">â• Add Patient</button>
    </form>
  </div>

    <!-- Appointments Management -->
  <div class="card">
    <h3>All Appointments (<%= appointments.length %>)</h3>
    <% if (appointments.length === 0) { %>
      <p>No appointments found.</p>
    <% } else { %>
      <table border="1" cellpadding="8" cellspacing="0" style="width:100%; text-align:left; border-collapse: collapse;">
        <thead>
          <tr>
            <th>ID</th>
            <th>Patient</th>
            <th>Doctor</th>
            <th>Clinic</th>
            <th>Date</th>
            <th>Time</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody>
          <% appointments.forEach(a => { %>
            <tr>
              <td><%= a.id %></td>
              <td><%= a.patientName %></td>
              <td><%= a.doctorName %></td>
              <td><%= a.clinicName %></td>
              <td><%= a.date %></td>
              <td><%= a.time %></td>
              <td><%= a.status %></td>
            </tr>
          <% }) %>
        </tbody>
      </table>
    <% } %>
  </div>


</div>

<script>
function toggleLocationFields() {
  const type = document.getElementById("locationType").value;
  document.getElementById("clinicSelect").style.display = (type === "clinic") ? "block" : "none";
  document.getElementById("customAddress").style.display = (type === "custom") ? "block" : "none";
}

document.getElementById('select-all-days').addEventListener('change', function(event) {
  const isChecked = event.target.checked;
  const dayCheckboxes = document.querySelectorAll('.day-checkbox');
  dayCheckboxes.forEach(checkbox => {
    checkbox.checked = isChecked;
  });
});
</script>
