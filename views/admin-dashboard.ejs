<%- include('partials/header.ejs') %>

<div class="dashboard-header">
    <h1>Welcome, <%= admin.name %> (Admin)</h1>
    <p>Oversee all system data across multiple clinics.</p>
</div>

<div class="dashboard-grid">
    <div class="card">
        <h3>Add New Doctor</h3>
        <form action="/admin/add-doctor" method="POST">
            <input type="hidden" name="adminId" value="<%= admin.id %>">
            <div class="form-group">
                <label for="name">Doctor's Full Name</label>
                <input type="text" id="name" name="name" required>
            </div>
            <div class="form-group">
                <label for="specialty">Specialty</label>
                <input type="text" id="specialty" name="specialty" placeholder="e.g., Cardiologist" required>
            </div>
            <div class="form-group">
                <label for="username">Create Username</label>
                <input type="text" id="username" name="username" required>
            </div>
            <div class="form-group">
                <label for="password">Create Password</label>
                <input type="password" id="password" name="password" required>
            </div>
            <button type="submit" class="btn">Add Doctor</button>
        </form>
        <p style="font-size: 0.9em; color: #666; margin-top: 1rem;">
            <em>Note: Admin adds doctors without clinic assignment. Receptionists can assign schedules.</em>
        </p>
    </div>

    <div class="card">
        <h3>All Appointments (<%= appointments.length %>)</h3>
        <ul class="appointment-list">
            <% if(appointments.length > 0) { %>
                <% 
                // Group appointments by clinic
                const appointmentsByClinic = {};
                appointments.forEach(app => {
                    const clinicName = app.clinicName || 'Unknown Clinic';
                    if (!appointmentsByClinic[clinicName]) {
                        appointmentsByClinic[clinicName] = [];
                    }
                    appointmentsByClinic[clinicName].push(app);
                });
                %>
                
                <% Object.keys(appointmentsByClinic).forEach(clinicName => { %>
                    <li class="appointment-item" style="background-color: #f8f9fa; margin-bottom: 1rem;">
                        <strong style="color: #007bff; font-size: 1.1em;"><%= clinicName %></strong>
                        <ul style="margin-top: 0.5rem; list-style: none; padding-left: 0;">
                            <% appointmentsByClinic[clinicName].forEach(app => { %>
                                <li style="padding: 0.3rem 0; border-bottom: 1px solid #eee;">
                                    <%= app.patientName %> with <%= app.doctorName %> on <%= app.date %>
                                </li>
                            <% }) %>
                        </ul>
                    </li>
                <% }) %>
            <% } else { %>
                <p>No appointments scheduled.</p>
            <% } %>
        </ul>
    </div>
</div>

