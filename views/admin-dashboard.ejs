<%- include('partials/header.ejs') %>

<h1>Welcome, <%= admin.name %> (Admin)</h1>

<div class="dashboard-grid">
    <div class="card">
        <h3>Clinics</h3>
        <ul>
            <% clinics.forEach(c => { %>
                <li><%= c.name %> <form action="/admin/delete-clinic" method="POST" style="display:inline;"><input type="hidden" name="clinicId" value="<%= c.id %>"><input type="hidden" name="adminId" value="<%= admin.id %>"><button type="submit">Delete</button></form></li>
            <% }) %>
        </ul>
        <form action="/admin/add-clinic" method="POST">
            <input type="hidden" name="adminId" value="<%= admin.id %>">
            <input type="text" name="name" placeholder="Clinic Name" required>
            <input type="text" name="address" placeholder="Address" required>
            <input type="text" name="phone" placeholder="Phone" required>
            <button type="submit">Add Clinic</button>
        </form>
    </div>

    <div class="card">
        <h3>Doctors</h3>
        <ul>
            <% doctors.forEach(d => { %>
                <li><%= d.name %> - <%= d.specialty %> <form action="/admin/delete-doctor" method="POST" style="display:inline;"><input type="hidden" name="doctorId" value="<%= d.id %>"><input type="hidden" name="adminId" value="<%= admin.id %>"><button type="submit">Delete</button></form></li>
            <% }) %>
        </ul>
        <form action="/admin/add-doctor" method="POST">
            <input type="hidden" name="adminId" value="<%= admin.id %>">
            <input type="text" name="name" placeholder="Doctor Name" required>
            <input type="text" name="specialty" placeholder="Specialty" required>
            <input type="text" name="username" placeholder="Username" required>
            <input type="password" name="password" placeholder="Password" required>
            <input type="number" name="dailyLimit" placeholder="Daily Patient Limit" required>
            <div>
                <label>Assign to Clinics:</label><br>
                <% clinics.forEach(c => { %>
                    <input type="checkbox" name="clinicIds" value="<%= c.id %>"> <%= c.name %><br>
                <% }) %>
            </div>
            <input type="text" name="customAddress" placeholder="Or, Private Practice Address">
            <input type="time" name="startTime" required>
            <input type="time" name="endTime" required>
            <input type="text" name="days" placeholder="e.g., Monday, Wednesday" required>
            <button type="submit">Add Doctor</button>
        </form>
    </div>

    <div class="card">
        <h3>Patients</h3>
        <ul>
            <% patients.forEach(p => { %>
                <li><%= p.name %> <form action="/admin/delete-patient" method="POST" style="display:inline;"><input type="hidden" name="patientId" value="<%= p.id %>"><input type="hidden" name="adminId" value="<%= admin.id %>"><button type="submit">Delete</button></form></li>
            <% }) %>
        </ul>
        <form action="/admin/add-patient" method="POST">
            <input type="hidden" name="adminId" value="<%= admin.id %>">
            <input type="text" name="name" placeholder="Patient Name" required>
            <input type="date" name="dob" required>
            <input type="text" name="mobile" placeholder="Mobile" required>
            <input type="text" name="username" placeholder="Username" required>
            <input type="password" name="password" placeholder="Password" required>
            <button type="submit">Add Patient</button>
        </form>
    </div>
    
    <div class="card">
        <h3>Today's Appointments</h3>
        <table>
            <thead>
                <tr>
                    <th>Patient</th>
                    <th>Doctor</th>
                    <th>Time</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody>
                <% 
                const today = new Date().toISOString().slice(0, 10);
                const todaysAppointments = appointments.filter(a => a.date === today);
                %>
                <% if(todaysAppointments.length > 0) { %>
                    <% todaysAppointments.forEach(a => { %>
                        <tr>
                            <td><%= a.patientName %></td>
                            <td><%= a.doctorName %></td>
                            <td><%= a.time %></td>
                            <td><%= a.status %></td>
                        </tr>
                    <% }) %>
                <% } else { %>
                    <tr><td colspan="4">No appointments today.</td></tr>
                <% } %>
            </tbody>
        </table>
        
        <h4>Add Appointment (Admin)</h4>
        <form action="/admin/add-appointment" method="POST">
             <input type="hidden" name="adminId" value="<%= admin.id %>">
             <select name="patientId" required>
                <% patients.forEach(p => { %>
                    <option value="<%= p.id %>"><%= p.name %></option>
                <% }) %>
             </select>
             <select name="doctorId" required>
                <% doctors.forEach(d => { %>
                    <option value="<%= d.id %>"><%= d.name %></option>
                <% }) %>
             </select>
             <select name="clinicId" required>
                <% clinics.forEach(c => { %>
                    <option value="<%= c.id %>"><%= c.name %></option>
                <% }) %>
             </select>
             <input type="date" name="date" required>
             <input type="time" name="time" required>
             <button type="submit">Add Appointment</button>
        </form>
    </div>
</div>

<%- include('partials/footer.ejs') %>