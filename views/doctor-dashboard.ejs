<%- include('partials/header.ejs') %>

<div class="dashboard-header">
    <h1>Welcome, Dr. <%= doctor.name %></h1>
    <p>Manage your appointments and schedule.</p>
</div>

<div class="dashboard-grid">
    <div class="card">
        <h3>Your Appointments</h3>
        <% if(appointments.length > 0) { %>
            <% appointments.forEach(app => { %>
                <div class="appointment-item">
                    <strong>Patient: <%= app.patientName %></strong> (Queue: <%= app.queueNumber %>)<br>
                    Date: <%= app.date %> at <%= app.time %><br>
                    Status: <%= app.status %><br>
                    <form action="/doctor/update-appointment-status" method="POST" style="display: inline;">
                        <input type="hidden" name="doctorId" value="<%= doctor.id %>">
                        <input type="hidden" name="appointmentId" value="<%= app.id %>">
                        <select name="status" onchange="this.form.submit()">
                            <option value="Confirmed" <%= app.status === 'Confirmed' ? 'selected' : '' %>>Confirmed</option>
                            <option value="Waiting" <%= app.status === 'Waiting' ? 'selected' : '' %>>Waiting</option>
                            <option value="Done" <%= app.status === 'Done' ? 'selected' : '' %>>Done</option>
                            <option value="Absent" <%= app.status === 'Absent' ? 'selected' : '' %>>Absent</option>
                        </select>
                    </form>
                </div>
            <% }) %>
        <% } else { %>
            <p>No appointments today.</p>
        <% } %>
    </div>

    <div class="card">
        <h3>Your Schedule</h3>
        <ul class="appointment-list">
            <% schedules.forEach(schedule => { %>
                <li class="appointment-item">
                    <strong><%= schedule.clinic.name %></strong><br>
                    <%= schedule.startTime %> - <%= schedule.endTime %><br>
                    <small><%= schedule.days %></small>
                </li>
            <% }) %>
        </ul>
        <hr>
        <h4>Set Daily Patient Limit</h4>
        <form action="/doctor/set-limit" method="POST">
            <input type="hidden" name="doctorId" value="<%= doctor.id %>">
            <input type="number" name="dailyLimit" value="<%= doctor.dailyLimit %>" required>
            <button type="submit" class="btn">Set Limit</button>
        </form>
    </div>
</div>

<%- include('partials/footer.ejs') %>